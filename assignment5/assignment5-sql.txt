SELECT o.order_id, SUM(p.price*li.quantity) AS total_price FROM orders o JOIN line_items li ON o.order_id=li.order_id 
JOIN products p ON li.product_id=p.product_id GROUP BY o.order_id ORDER BY o.order_id LIMIT 5;

SELECT c.customer_name, AVG(t.total_price) AS average_order_price FROM customers c JOIN (SELECT o.customer_id, o.order_id, SUM(p.price * li.quantity) 
AS total_price FROM orders o JOIN line_items li ON o.order_id = li.order_id JOIN products p ON li.product_id = p.product_id GROUP BY o.customer_id, o.order_id) 
AS t ON c.customer_id=t.customer_id GROUP BY c.customer_id, c.customer_name ORDER BY c.customer_name;

SELECT customer_id FROM customers WHERE customer_name='Perez and Sons';
SELECT employee_id FROM employees WHERE first_name='Miranda' AND last_name='Harris';
SELECT product_id  FROM products ORDER BY price ASC LIMIT 5;
BEGIN;
INSERT INTO orders (customer_id, employee_id, date) VALUES (3,2,'2025-03-11') RETURNING order_id;
INSERT INTO line_items (order_id, product_id, quantity) SELECT $1, product_id, 1 FROM products ORDER BY price ASC LIMIT 5;
COMMIT;
SELECT * FROM line_items WHERE order_id = (SELECT MAX(order_id) FROM orders);


SELECT employees.first_name, employees.last_name,COUNT(orders.order_id) AS order_count FROM employees JOIN orders ON employees.employee_id = orders.employee_id 
GROUP BY employees.employee_id, employees.first_name, employees.last_name HAVING COUNT(orders.order_id) > 5 ORDER BY employees.last_name;
